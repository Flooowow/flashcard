<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quizart - Histoire de l'Art</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="achievements.css">
  <style>
    /* Sidebar compacte */
    .sidebar-header-compact {
      padding: 15px;
      background: var(--light-cream);
      border-bottom: 2px solid var(--beige);
    }

    .sidebar-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .sidebar-top-row h2 {
      margin: 0;
      font-size: 18px;
      color: var(--burgundy);
    }

    .btn-compact {
      padding: 8px 16px !important;
      font-size: 13px !important;
      white-space: nowrap;
    }

    .stats-compact {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      border: 1px solid var(--beige);
    }

    .stat-compact {
      flex: 1;
      text-align: center;
    }

    .stat-compact-value {
      display: block;
      font-size: 18px;
      font-weight: 700;
      color: var(--burgundy);
      line-height: 1.2;
    }

    .stat-compact-label {
      display: block;
      font-size: 10px;
      color: var(--anthracite);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 2px;
    }

    .sidebar-actions-row {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
    }

    .achievements-badge-compact {
      flex: 1;
      padding: 8px 12px;
      background: linear-gradient(135deg, var(--gold) 0%, #DAA520 100%);
      border-radius: 8px;
      color: white;
      font-weight: 700;
      font-size: 12px;
      cursor: pointer;
      transition: transform 0.2s;
      text-align: center;
      box-shadow: 0 2px 6px rgba(212, 175, 55, 0.3);
    }

    .achievements-badge-compact:hover {
      transform: translateY(-2px);
    }

    .btn-compact-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border: none;
      background: white;
      border: 2px solid var(--beige);
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-compact-icon:hover {
      background: var(--cream);
      border-color: var(--gold);
      transform: translateY(-2px);
    }

    .sort-select-compact {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid var(--beige);
      border-radius: 8px;
      background: white;
      color: var(--anthracite);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: border-color 0.2s;
    }

    .sort-select-compact:hover {
      border-color: var(--gold);
    }

    .sort-select-compact:focus {
      outline: none;
      border-color: var(--burgundy);
    }

    .cards-list {
      max-height: calc(100vh - 230px);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-left">
      <img src="logo.png" alt="QuizArt Logo" class="header-logo">
      <div class="header-text">
        <h1>Quizart</h1>
        <p class="tagline">DÃ©couvrez l'histoire de l'art autrement</p>
      </div>
    </div>
    <div class="mode-toggle">
      <button id="editModeBtn" class="mode-btn active">âœï¸ Mode Ã‰dition</button>
      <button id="quizModeBtn" class="mode-btn">ğŸ¯ Mode Quiz</button>
    </div>
  </header>

  <!-- MODE Ã‰DITION -->
  <div id="editMode" class="mode-container active">
    <div class="editor-layout">
      <!-- Sidebar avec liste des cartes -->
      <aside class="cards-sidebar">
        <!-- Header compact -->
        <div class="sidebar-header-compact">
          <div class="sidebar-top-row">
            <h2>ğŸ“š Cartes</h2>
            <button id="addCardBtn" class="btn btn-primary btn-compact">â• Nouvelle</button>
          </div>
          
          <!-- Stats ultra-compactes -->
          <div class="stats-compact">
            <div class="stat-compact">
              <span class="stat-compact-value" id="globalTotalCards">0</span>
              <span class="stat-compact-label">cartes</span>
            </div>
            <div class="stat-compact">
              <span class="stat-compact-value" id="globalToReview">0</span>
              <span class="stat-compact-label">Ã  rÃ©viser</span>
            </div>
            <div class="stat-compact">
              <span class="stat-compact-value stat-success" id="globalSuccessRate">0%</span>
              <span class="stat-compact-label">rÃ©ussite</span>
            </div>
            <div class="stat-compact">
              <span class="stat-compact-value" style="color: var(--gold);" id="globalAvgMastery">0%</span>
              <span class="stat-compact-label">maÃ®trise</span>
            </div>
          </div>
          
          <!-- Badge succÃ¨s + boutons en ligne -->
          <div class="sidebar-actions-row">
            <div class="achievements-badge-compact" id="achievementsBadge" onclick="showAchievementsModal()" title="Mes succÃ¨s">
              ğŸ† <span id="achievementsCount">0</span>/<span id="achievementsTotal">32</span>
            </div>
            <button id="viewSessionStatsBtn" class="btn-compact-icon" title="Voir les sessions">ğŸ“Š</button>
            <button id="exportBtn" class="btn-compact-icon" title="Sauvegarder">ğŸ’¾</button>
            <button id="importBtn" class="btn-compact-icon" title="Restaurer">ğŸ“‚</button>
            <button id="repairBtn" class="btn-compact-icon" title="RÃ©parer">ğŸ”§</button>
            <input type="file" id="importFile" accept=".json" style="display: none;">
          </div>
          
          <!-- Tri compact -->
          <select id="sortSelect" class="sort-select-compact">
            <option value="order">ğŸ“‹ Ordre par dÃ©faut</option>
            <option value="date-asc">ğŸ“… Date â†‘</option>
            <option value="date-desc">ğŸ“… Date â†“</option>
            <option value="artist">ğŸ‘¤ Artiste A-Z</option>
            <option value="mastery">ğŸ¯ PrioritÃ©</option>
          </select>
        </div>
        
        <div id="cardsList" class="cards-list">
          <!-- Les cartes seront ajoutÃ©es ici dynamiquement -->
        </div>
      </aside>

      <!-- Zone d'Ã©dition principale -->
      <main class="editor-main">
        <div id="editorContent" class="editor-content">
          <div class="empty-state">
            <div class="empty-icon">ğŸ¨</div>
            <h3>Aucune carte sÃ©lectionnÃ©e</h3>
            <p>SÃ©lectionnez une carte ou crÃ©ez-en une nouvelle</p>
          </div>
        </div>

        <!-- Formulaire d'Ã©dition (cachÃ© par dÃ©faut) -->
        <div id="cardEditor" class="card-editor" style="display: none;">
          <div class="editor-header">
            <h3>Ã‰dition de la carte</h3>
            <div class="header-actions">
              <div id="masteryBadge" class="mastery-badge">
                <span style="color: #9CA3AF; font-size: 24px;">ğŸ“</span>
                <span style="font-weight: 700; font-size: 20px; color: #9CA3AF;">0%</span>
                <span style="font-size: 12px; color: var(--anthracite);">Non rÃ©visÃ©e</span>
              </div>
              <button id="deleteCardBtn" class="btn btn-danger">ğŸ—‘ï¸ Supprimer</button>
            </div>
          </div>

          <!-- Statistiques de la carte -->
          <div id="cardStats" class="card-stats">
            <h4>ğŸ“Š Statistiques</h4>
            <div class="stats-grid">
              <div class="stat-box">
                <span class="stat-number" id="statPlayed">0</span>
                <span class="stat-label">Fois jouÃ©e</span>
              </div>
              <div class="stat-box">
                <span class="stat-number stat-success" id="statCorrect">0</span>
                <span class="stat-label">RÃ©ussites totales</span>
              </div>
              <div class="stat-box">
                <span class="stat-number stat-error" id="statWrong">0</span>
                <span class="stat-label">Erreurs</span>
              </div>
              <div class="stat-box">
                <span class="stat-number stat-rate" id="statRate">0%</span>
                <span class="stat-label">Taux global</span>
              </div>
            </div>
            
            <!-- Statistiques dÃ©taillÃ©es par composant -->
            <div class="stats-detailed">
              <h5>ğŸ“ˆ Taux de rÃ©ussite par composant</h5>
              <div class="stats-detail-grid">
                <div class="stat-detail-box">
                  <span class="stat-detail-icon">ğŸ‘¤</span>
                  <span class="stat-detail-label">Artiste</span>
                  <span class="stat-detail-value" id="statArtistRate">0%</span>
                </div>
                <div class="stat-detail-box">
                  <span class="stat-detail-icon">ğŸ¨</span>
                  <span class="stat-detail-label">Titre</span>
                  <span class="stat-detail-value" id="statTitleRate">0%</span>
                </div>
                <div class="stat-detail-box">
                  <span class="stat-detail-icon">ğŸ“…</span>
                  <span class="stat-detail-label">Date</span>
                  <span class="stat-detail-value" id="statDateRate">0%</span>
                </div>
              </div>
              <div style="text-align: center; margin-top: 10px; padding: 10px; background: var(--light-cream); border-radius: 8px; border: 1px solid var(--beige);">
                <span style="font-size: 12px; color: var(--anthracite); font-weight: 600;">ğŸ“… DerniÃ¨re rÃ©vision :</span>
                <span id="lastPlayed" style="font-size: 12px; color: var(--burgundy); font-weight: 700; margin-left: 5px;">Jamais</span>
              </div>
            </div>
            
            <button id="resetStatsBtn" class="btn btn-secondary btn-small">ğŸ”„ RÃ©initialiser les stats</button>
          </div>

          <div class="form-group">
            <label for="cardImage">Image de l'Å“uvre *</label>
            <input type="file" id="cardImage" accept="image/*">
            <div id="imagePreview" class="image-preview"></div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="cardArtist">Artiste *</label>
              <input type="text" id="cardArtist" placeholder="Ex: Caravage" required>
            </div>

            <div class="form-group">
              <label for="cardDate">Date *</label>
              <input type="text" id="cardDate" placeholder="Ex: 1602" required>
            </div>
          </div>

          <div class="form-group">
            <label for="cardTitle">Titre de l'Å“uvre *</label>
            <input type="text" id="cardTitle" placeholder="Ex: Le Caravage Ã  EmmaÃ¼s" required>
          </div>

          <div class="form-group">
            <label for="cardNote">ğŸ“ Note / Moyen mnÃ©motechnique</label>
            <textarea id="cardNote" placeholder="Ex: Peint pendant son exil Ã  Naples - Clair-obscur caractÃ©ristique" rows="3"></textarea>
            <small style="color: var(--gray-700); font-size: 12px;">Cette note s'affichera aprÃ¨s votre rÃ©ponse pour vous aider Ã  mÃ©moriser</small>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="cardHasError">
              <span>âš ï¸ Cette carte contient une erreur</span>
            </label>
            <small style="color: var(--gray-700); font-size: 12px; display: block; margin-top: 5px;">Cochez si vous avez dÃ©tectÃ© une erreur (artiste, titre, date incorrects)</small>
          </div>

          <div class="editor-actions">
            <button id="saveCardBtn" class="btn btn-success">ğŸ’¾ Enregistrer</button>
            <button id="cancelEditBtn" class="btn btn-secondary">Annuler</button>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- MODE QUIZ -->
  <div id="quizMode" class="mode-container">
    <div class="quiz-container">
      <!-- En-tÃªte du quiz -->
      <div class="quiz-header">
        <div class="quiz-header-content">
          <div class="quiz-header-top">
            <img src="logo.png" alt="QuizArt Logo" class="quiz-logo">
            <h2 id="quizTitle">TESTEZ VOS CONNAISSANCES</h2>
          </div>
          
          <!-- SÃ©lecteur de mode -->
          <div class="quiz-mode-selector">
            <button class="quiz-mode-btn active" data-mode="all">ğŸ“š Toutes les cartes</button>
            <button class="quiz-mode-btn" data-mode="smart">ğŸ§  RÃ©vision intelligente</button>
            <button class="quiz-mode-btn" data-mode="manual">â­ SÃ©lection manuelle</button>
          </div>
        </div>
        
        <div class="quiz-progress">
          <div class="quiz-progress-row">
            <span id="progressText">1 / 55</span>
            <span id="timerDisplay" class="timer-display">â±ï¸ 0s</span>
          </div>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>
      </div>

      <!-- Contenu du quiz -->
      <div id="quizContent" class="quiz-content">
        <!-- Ã‰tat vide -->
        <div id="quizEmpty" class="empty-state">
          <div class="empty-icon">ğŸ“</div>
          <h3>Aucune carte disponible</h3>
          <p>CrÃ©ez des cartes en mode Ã©dition pour commencer le quiz</p>
        </div>

        <!-- Carte du quiz -->
        <div id="quizCard" class="quiz-card" style="display: none;">
          <div class="card-image-container">
            <img id="quizCardImage" src="" alt="Å’uvre d'art">
          </div>
          
          <div class="quiz-answer">
            <input type="text" id="quizInput" placeholder="Votre rÃ©ponse" autocomplete="off">
            <button id="verifyBtn" class="btn btn-verify">VÃ©rifier</button>
          </div>

          <div id="quizFeedback" class="quiz-feedback" style="display: none;">
            <div class="feedback-content">
              <span class="feedback-icon"></span>
              <span class="feedback-text"></span>
            </div>
            <div class="correct-answer" id="correctAnswer"></div>
            
            <!-- Checkbox pour signaler une erreur -->
            <div class="card-error-checkbox">
              <label>
                <input type="checkbox" id="cardErrorCheckbox">
                <span>âš ï¸ Signaler une erreur dans cette carte</span>
              </label>
            </div>
            
            <div id="noteDisplay" class="note-display">
              <div class="note-header">ğŸ“ Note / Moyen mnÃ©motechnique</div>
              <textarea id="noteInput" class="note-input" placeholder="Ã‰crivez ici vos astuces, contexte historique, moyen mnÃ©motechnique..." rows="3"></textarea>
              <button id="saveNoteBtn" class="btn btn-success btn-small" style="margin-top: 10px;">ğŸ’¾ Sauvegarder</button>
            </div>
          </div>
        </div>

        <!-- Carte de rÃ©sultat -->
        <div id="quizResult" class="quiz-result" style="display: none;">
          <div class="result-icon">ğŸ‰</div>
          <h3>Quiz terminÃ© !</h3>
          <div class="result-stats">
            <div class="stat">
              <span class="stat-value" id="correctCount">0</span>
              <span class="stat-label">Bonnes rÃ©ponses</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="wrongCount">0</span>
              <span class="stat-label">Erreurs</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="scorePercent">0%</span>
              <span class="stat-label">Score</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="pointsScore">0/0</span>
              <span class="stat-label">Points</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="pointsPercent">0%</span>
              <span class="stat-label">Taux points</span>
            </div>
            <div class="stat">
              <span class="stat-value" id="sessionTime">0min 0s</span>
              <span class="stat-label">â±ï¸ Temps total</span>
            </div>
          </div>
          <div class="result-actions">
            <button id="restartQuizBtn" class="btn btn-primary">ğŸ”„ Recommencer</button>
            <button id="viewHistoryBtn" class="btn btn-secondary">ğŸ“ˆ Voir l'historique</button>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="quiz-navigation">
        <button id="prevCardBtn" class="nav-btn" disabled>â† PrÃ©cÃ©dent</button>
        <button id="nextCardBtn" class="nav-btn">Suivant â†’</button>
      </div>
    </div>
  </div>

  <!-- Toast notifications -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Modal Historique -->
  <div id="historyModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3>ğŸ“ˆ Historique des quiz</h3>
        <button class="modal-close" onclick="closeHistoryModal()">âœ•</button>
      </div>
      
      <div id="historyContent" class="history-content">
        <div class="history-empty">
          <div class="empty-icon">ğŸ“Š</div>
          <p>Aucun historique pour le moment</p>
          <p class="small">ComplÃ©tez un quiz pour voir vos statistiques</p>
        </div>
        
        <div id="historyChart" style="display: none;">
          <canvas id="progressChart" width="600" height="300"></canvas>
        </div>
        
        <div id="historyList" class="history-list"></div>
      </div>
      
      <div class="modal-footer">
        <button id="clearHistoryBtn" class="btn btn-danger">ğŸ—‘ï¸ Effacer l'historique</button>
        <button class="btn btn-secondary" onclick="closeHistoryModal()">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modal Statistiques de Session -->
  <div id="sessionStatsModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3>ğŸ“Š Statistiques par session</h3>
        <button class="modal-close" id="closeSessionStatsBtn">âœ•</button>
      </div>
      
      <div class="session-stats-content">
        <div id="sessionStatsList" class="session-stats-list">
          <!-- Les statistiques seront ajoutÃ©es ici -->
        </div>
      </div>
      
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSessionStatsModal()">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmation -->
  <div id="confirmModal" class="modal modal-popup">
    <div class="popup-overlay" onclick="document.getElementById('confirmNo').click()"></div>
    <div class="modal-content modal-confirm">
      <div class="confirm-icon">âš ï¸</div>
      <h3 id="confirmTitle">Confirmation</h3>
      <p id="confirmMessage">ÃŠtes-vous sÃ»r ?</p>
      <div class="modal-buttons">
        <button id="confirmYes" class="btn btn-danger">Oui</button>
        <button id="confirmNo" class="btn btn-secondary">Non</button>
      </div>
    </div>
  </div>

  <!-- Modal des succÃ¨s -->
  <div class="achievements-modal" id="achievementsModal">
    <div class="achievements-modal-content">
      <!-- Header -->
      <div class="achievements-modal-header">
        <div>
          <div class="achievements-modal-title">
            <span>ğŸ†</span>
            <span>Mes SuccÃ¨s</span>
          </div>
          <div class="achievements-modal-progress">
            <span id="modalAchievementsCount">0</span> sur <span id="modalAchievementsTotal">32</span> succÃ¨s dÃ©bloquÃ©s
          </div>
        </div>
        <button class="achievements-modal-close" onclick="closeAchievementsModal()">âœ•</button>
      </div>

      <!-- Filtres -->
      <div class="achievements-filters">
        <button class="achievement-filter-btn active" data-filter="all">Tous</button>
        <button class="achievement-filter-btn" data-filter="discovery">ğŸ¨ DÃ©couverte</button>
        <button class="achievement-filter-btn" data-filter="revision">ğŸ“š RÃ©vision</button>
        <button class="achievement-filter-btn" data-filter="performance">ğŸ¯ Performance</button>
        <button class="achievement-filter-btn" data-filter="specialization">ğŸ§  SpÃ©cialisation</button>
        <button class="achievement-filter-btn" data-filter="challenge">ğŸ… DÃ©fis</button>
        <button class="achievement-filter-btn" data-filter="progression">ğŸ“ˆ Progression</button>
      </div>

      <!-- Liste des succÃ¨s -->
      <div class="achievements-list" id="achievementsList">
        <!-- GÃ©nÃ©rÃ© dynamiquement -->
      </div>

      <!-- Stats globales -->
      <div class="achievements-stats">
        <div class="achievement-stat">
          <span class="achievement-stat-value" id="statCommon">0</span>
          <span class="achievement-stat-label">âšª Communs</span>
        </div>
        <div class="achievement-stat">
          <span class="achievement-stat-value" id="statRare">0</span>
          <span class="achievement-stat-label">ğŸ”µ Rares</span>
        </div>
        <div class="achievement-stat">
          <span class="achievement-stat-value" id="statEpic">0</span>
          <span class="achievement-stat-label">ğŸŸ£ Ã‰piques</span>
        </div>
        <div class="achievement-stat">
          <span class="achievement-stat-value" id="statLegendary">0</span>
          <span class="achievement-stat-label">ğŸŸ¡ LÃ©gendaires</span>
        </div>
      </div>
    </div>
  </div>

  <script src="db-manager.js?v=5"></script>
  <script src="achievements.js"></script>
  <script src="achievements-ui.js"></script>
  <script src="script.js?v=4"></script>
</body>
</html>
